"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[105],{88625:(e,t,a)=>{a.r(t),a.d(t,{SpaceSubscriptionUpdatePaymentMethodModal:()=>B});var r=a(77094),o=a.n(r),n=(a(33948),a(81407)),i=a(67294),s=a.n(i),d=a(480),l=a(28350),p=a(24405),c=a(8848),u=a(97880),m=a(82990),g=a(5366),v=a(21325),y=a(16100),f=a(1643),b=a(27832),h=a(95155),C=a(45407),S=a(78291),M=a(72693),k=a(47966),P=a(46951);function B(e){return o()(n.Elements,{stripe:(0,y.getStripe)()},void 0,s().createElement(x,e))}function x(e){const[t,a,r]=(0,l.oR)(void 0,C.Z),[c]=(0,l.oR)(S.default),m=(0,n.useStripe)(),y=(0,n.useElements)(),[b,B]=s().useState(!1),[x,_]=s().useState(void 0),R=(0,d.O7)(),U=(0,g.useIntl)(),[,,D]=(0,l.oR)(h.default);(0,i.useEffect)((()=>{c.data&&!r.isPaymentOptionAvailable("invoice")&&f.BV(f.su(c.data))&&r.addPaymentOption("invoice")}),[R,e.customerData.productId,c,r,D]);const F=s().useCallback(((e,o)=>{t.paymentRequest||(a({...t,paymentRequest:e,supportsApplePay:Boolean(o&&o.applePay)}),r.addPaymentOption("native_payment_platform"))}),[a,r,t]);s().useEffect((()=>{if(m){const t=m.paymentRequest({country:"US",currency:"usd",total:{label:U.formatMessage({id:"spaceSubscriptionUpdatePaymentMethod.applePay.total.label",defaultMessage:"Notion - You will be charged on a recurring basis"}),amount:0}});t.canMakePayment().then((e=>{e&&F(t,e)})),t.on("token",(t=>{E({environment:R,spaceStore:e.spaceStore,stripeToken:t.token.id,customerData:e.customerData,onComplete:a=>{t.complete(a?"success":"fail"),e.onComplete()}})}))}}),[m,e,U,R,F]);const T=f.zt(t.availablePaymentMethods),q=(0,p.y)(w,[]);return b?o()("div",{style:q.container},void 0,o()("div",{style:q.header},void 0,o()(g.FormattedMessage,{id:"spaceSubscriptionUpdatePaymentMethod.creditCard.update.header",defaultMessage:"Update credit card"})),o()("div",{style:q.cardContainer},void 0,o()(n.CardElement,{options:{hidePostalCode:!0}})),x&&o()(P.Z,{isMultiline:!1,style:q.error},void 0,x),o()("div",{style:q.upgradeButtonContainer},void 0,o()(M.Z,{style:q.upgradeButton,onClick:()=>async function(e){const{stripe:t,elements:a,environment:r,spaceStore:o,customerData:i,onComplete:s,setError:d}=e;if(!t||!a)return;const l=a.getElement(n.CardElement);if(!l)return;const p=await t.createToken(l);!p.error&&p.token?await E({environment:r,spaceStore:o,stripeToken:p.token.id,customerData:i,onComplete:s}):p.error&&d(p.error.message)}({stripe:m,elements:y,environment:R,spaceStore:e.spaceStore,customerData:e.customerData,onComplete:e.onComplete,setError:_})},void 0,o()(g.FormattedMessage,{id:"spaceSubscriptionUpdatePaymentMethod.creditCard.updateButton",defaultMessage:"Update"})))):o()("div",{style:q.container},void 0,o()("div",{style:q.header},void 0,o()(g.FormattedMessage,{id:"spaceSubscriptionUpdatePaymentMethod.update.header",defaultMessage:"Update payment method"})),o()("div",{style:q.optionGroup},void 0,T.map(((a,r)=>{let{type:n,title:i}=a;return o()("div",{onClick:()=>async function(e){const{newPaymentMethod:t,setCreditCardSelected:a,paymentRequest:r,environment:o,spaceStore:n,onComplete:i}=e;"credit_card"===t?a(!0):"invoice"===t?(await v.Mg({environment:o,spaceStore:n,billing:"send_invoice"}),i()):"native_payment_platform"===t?r&&r.show():(0,u.t1)(t)}({newPaymentMethod:n,paymentRequest:t.paymentRequest,setCreditCardSelected:B,environment:R,spaceStore:e.spaceStore,onComplete:e.onComplete})},n,o()(k.Z,{style:{...q.option,...r!==T.length-1?q.optionBorder:void 0}},void 0,i))}))))}async function E(e){const{environment:t,spaceStore:a,stripeToken:r,customerData:o,onComplete:n}=e,{currentUserStore:i}=b.default.state,s=i?i.getValue():void 0,d=o.billingEmail||(s?s.email:void 0);if(!d)throw new Error("No billing email found.");n(await v.Mg({environment:t,spaceStore:a,billing:"charge_automatically",stripeToken:r,billingEmail:d}))}function w(e){return{container:{width:500,background:e.popoverBackground,padding:30,borderRadius:3},optionGroup:{borderRadius:"2px",background:e.groupedFormBackground,border:"1px solid",borderColor:e.groupedFormBorder},option:{display:"flex",justifyContent:"flex-start",border:"none",height:void 0,paddingTop:"15px",paddingBottom:"15px"},optionBorder:{borderBottom:"1px solid",borderBottomColor:e.groupedFormBorder},header:{fontSize:18,marginBottom:16,fontWeight:m.Z.fontWeight.medium},cardContainer:{backgroundColor:e.groupedFormBackground,borderWidth:1,borderStyle:"solid",borderColor:e.groupedFormBackground,padding:"10px",marginTop:"10px",marginBottom:"10px"},upgradeButtonContainer:{width:"100%",justifyContent:"flex-end",display:"flex"},upgradeButton:{marginTop:"20px"},error:{marginTop:8,color:c.ZP.red}}}},16100:(e,t,a)=>{a.r(t),a.d(t,{injectStripe:()=>c,getStripe:()=>u,translateStripeError:()=>m});var r=a(77094),o=a.n(r),n=a(81407),i=a(97894),s=a(67294),d=a.n(s),l=a(95477);let p=null;function c(e){return t=>o()(n.Elements,{stripe:u()},void 0,o()(n.ElementsConsumer,{},void 0,(a=>{let{stripe:r,elements:o}=a;const n={...t,stripe:r,elements:o};return d().createElement(e,n)})))}async function u(){return p||(i.loadStripe.setLoadParameters({advancedFraudSignals:!1}),p=(0,i.loadStripe)(l.default.stripe.key)),p}function m(e,t){if(!t.code)return t.message||"";switch(t.code){case"invalid_expiry_year_past":return e.formatMessage({id:"stripeHelpers.invalidExpiryYear.error.message",defaultMessage:"Your card's expiration year is in the past."});case"invalid_cvc":return e.formatMessage({id:"stripeHelpers.invalidCVC.error.message",defaultMessage:"Your card's security code is invalid."});case"invalid_number":return e.formatMessage({id:"stripeHelpers.invalidNumber.error.message",defaultMessage:"Your card number is not a valid credit card number."});case"card_declined":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message",defaultMessage:"Your card was declined."});default:return t.message||""}}},45407:(e,t,a)=>{a.d(t,{Z:()=>s});a(33948);var r=a(96486),o=a.n(r),n=a(49085);class i extends n.Z{getInitialState(){return{availablePaymentMethods:["credit_card"],paymentRequest:void 0,supportsApplePay:!1}}isPaymentOptionAvailable(e){return this.state.availablePaymentMethods.includes(e)}addPaymentOption(e){const t=o().uniq([...this.state.availablePaymentMethods,e]);this.setState({...this.state,availablePaymentMethods:t})}}const s=i}}]);